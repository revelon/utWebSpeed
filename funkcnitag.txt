<style>

div.streamPlayer {
	border-radius: 3px;
	padding: 4px;
	position: absolute;
	opacity: 0;
	visibility: visible;
	top: 5%;
	left: 3%;
	width: 210px;
	height: 150px;
	font-size: 12px;
	cursor: default;
	background: rgba(217,11,131,0.7);
	pointer-events: none;
}

div.streamPlayer:hover {
	background: rgba(217,11,131,1);
}

div.streamPlayer.showBox {
	visibility: visible;
	opacity: 1;
	pointer-events: auto;
	-webkit-transition: opacity 2.5s ease 999ms;
	transition: opacity 2.5s ease 999ms;
}

svg#icoPlay {
	display: none;
	position: absolute;
	top: 32%;
	left: 40%;
	pointer-events: painted;
	cursor: default;
}

svg#icoPlay:hover circle {
	fill-opacity: .75;
}

svg#icoPlay:hover path {
	opacity: .95;
}

div.streamPlayer h4 {
	font-size: 14px;
	font-weight: 900px;
	text-align: center;
	margin-top: 5px;
	margin-bottom: 10px;
	border-bottom: 1px solid white;
}

div.streamPlayer h5 {
	font-size: 12px;
	font-weight: 900;
	text-align: right;
	margin-top: 12px;
	margin-right: 8px;
}

div.streamPlayer ul {
	list-style-type: square;
	list-style-position: inside;
	line-height: 172%;
}

#video-container, #video-container video {
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	object-fit: fill;
	margin: auto;
	pointer-events: none;
}

#watch {
	width: 148px;
	padding: 12px 25px 12px 50px;
}

#watch span.stop {
	display: block;
	position: absolute;
	top: 15px;
	left: 12px;
	width: 30px;
	height: 30px;
	background: transparent url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2230%22%20height%3D%2230%22%20viewBox%3D%220%200%2030%2030%22%3E%3Ccircle%20cx%3D%2215%22%20cy%3D%2215%22%20r%3D%2214%22%20stroke-width%3D%220%22%20fill%3D%22black%22%20fill-opacity%3D%22.28%22%2F%3E%3Cpath%20d%3D%22M10%2C10%2020%2C10%2020%2C20%2010%2C20z%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20stroke%3D%22gray%22%20fill-opacity%3D%22.88%22%20stroke-opacity%3D%22.5%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E') no-repeat;
}

#watch span {
	display: block;
	position: absolute;
	top: 15px;
	left: 12px;
	width: 30px;
	height: 30px;
	background: transparent url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2230%22%20height%3D%2230%22%20viewBox%3D%220%200%2030%2030%22%3E%3Ccircle%20cx%3D%2215%22%20cy%3D%2215%22%20r%3D%2214%22%20stroke-width%3D%220%22%20fill%3D%22black%22%20fill-opacity%3D%22.28%22%2F%3E%3Cpath%20d%3D%22M10%2C7%2023%2C15%2010%2C23z%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20stroke%3D%22gray%22%20fill-opacity%3D%22.88%22%20stroke-opacity%3D%22.5%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E') no-repeat;
}

</style>

<script>
$(document).ready(function () {

	// prepare data to test, if we can initialize the streaming player or not
  var vData = {{dl.videoData}} ? {{dl.videoData}} : {},
		myVid = document.createElement('video'),
		buttonHolder = $('div#fileDownload'),
		thumbHolder = $('div#fileVideo');

	if (location.hostname.indexOf('pornfile') === -1 || !vData.isStreamable || !vData.userCanStream || 
		!vData.streamUri || !myVid.canPlayType('video/mp4') || !buttonHolder.length || !thumbHolder.length) {
		return; // skip player initialization, conditions are not met
	}

	// PF is CZ-CS only, so we can put text directly in
	// benchmark for user connection speed vs bitrate etc. will come later, we are being optimistic for now

	// add new button
	buttonHolder.append('&nbsp;&nbsp;&nbsp;<a href="#view" id="watch" class="commonBigButton mu7" style="visibility:hidden">Přehrát video<span></span></a>');
	// add video, info box and icon to the image thumbnails area
	thumbHolder.append('<div id="video-container"><video src="[[STREAMDATAURI]]" preload controls style="visibility:hidden"></video></div><svg id="icoPlay" width="150" height="150" viewBox="0 0 30 30"><circle cx="15" cy="15" r="14" stroke-width="0" fill="black" fill-opacity=".4"/><path d="M10,7 23,15 10,23z" stroke-linejoin="round" stroke-width="1.2" stroke="white" opacity=".66" fill="rgb(217,11,131)"/></svg><div class="streamPlayer"><h4>Sleduj online &nbsp;<sup>BETA</sup></h4><ul><li>až čtvrtinu dat máš zdarma</li><li>zjisti, zda je to video, které hledáš</li><li>po odečtení kreditu sleduj či stahuj video po 24h neomezeně</li></ul><h5><a href="/faq?videostreaming#videostreaming" style="color:white">Více informací</a></h5></div>'.replace('[[STREAMDATAURI]]', vData.streamUri));

	// prepare necessary elements and variables
	var vid = $('div#video-container video'),
		video = vid[0],
		butt = $('a#watch'),
		hint = $('div.streamPlayer'),
		ico = $('svg#icoPlay'),
		state = 0;

	// set several listeners
	video.addEventListener('canplay', initPlayer);
	video.addEventListener('playing', playing);
	video.addEventListener('pause', pausePlay);
	video.addEventListener('ended', pausePlay);
	butt[0].addEventListener('click', checkPlay);
	hint[0].addEventListener('click', checkPlay);
	ico[0].addEventListener('click', checkPlay);

	// method run when video playback is turn on
	function initPlayer(evt) {
		hint.addClass('showBox');
		ico.css('display', 'block');
		butt.css('visibility', 'visible');
	}
	// method run when video playback is turn on
	function playing(evt) {
		state = 1;
		vid.css('visibility', 'visible');
		hint.removeClass('showBox');
		ico.css('display', 'none');
		vid.css('pointer-events', 'auto');
		butt.html('Zastavit video<span class="stop"></span>');
		dataLayer.push({'event':'ga.event', 'eCategory':'Videostreaming', 'eAction': 'Play', 'eLabel': undefined, 'eValue': undefined });
	}
	// method run when video is paused od ended
	function pausePlay(evt) {
		if (!video.seeking) {
			state = 0;
			hint.addClass('showBox');
			butt.html('Přehrát video<span></span>');
		}
	}
	// method run used for custom video control elements
	function checkPlay(evt) {
		if (state) {
			vid[0].pause();
			state = 0;
			butt.html('Přehrát video<span></span>');
		} else {
			vid[0].play();
			butt.html('Zastavit video<span class="stop"></span>');
		}
	}
});
</script>
