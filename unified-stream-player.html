<style>

div.streamPlayer {
	border-radius: 3px;
	padding: 4px;
	position: absolute;
	opacity: 0;
	visibility: visible;
	top: 5%;
	left: 3%;
	width: 210px;
	height: 150px;
	font-size: 12px;
	cursor: default;
	pointer-events: none;
	background: rgba(241, 200, 4, .85);
}

div.streamPlayer:hover {background: rgba(241, 200, 4, 1);}

div.streamPlayer.showBox {
	visibility: visible;
	opacity: 1;
	pointer-events: auto;
	-webkit-transition: opacity 2s ease 400ms;
	transition: opacity 2s ease 400ms;
}

svg#icoPlay {
	display: none;
	position: absolute;
	top: 32%;
	left: 40%;
	pointer-events: painted;
	cursor: default;
	opacity: 0;
	-webkit-transition: opacity 2s ease;
	transition: opacity 2s ease;
}

svg#icoPlay.initer {
	opacity: 1;
}

svg#icoPlay:hover circle {
	fill-opacity: .75;
}

svg#icoPlay:hover path {
	opacity: .95;
}

div.streamPlayer h4 {
	font-size: 14px;
	font-weight: 700;
	text-align: center;
	margin-top: 5px;
	margin-bottom: 10px;
	border-bottom: 1px solid white;
	padding-bottom: 2px;
}

div.streamPlayer h5 {
	font-size: 12px;
	font-weight: 900;
	text-align: right;
	margin-top: 12px;
	margin-right: 8px;
}

div.streamPlayer ul {
	list-style-type: square;
	list-style-position: inside;
	line-height: 172%;
}

#video-container, #video-container video {
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	object-fit: fill;
	margin: auto;
	pointer-events: none;
}

</style>

<script>
(function () {
	// prepare data to test, if we can initialize the streaming player or not

    var vData = {{dl.videoData}} ? {{dl.videoData}} : {}, // GTM scope case
    //var vData = dataLayer[0].videoData,
		myVid = document.createElement('video'),
		thumbHolder = $('div#fileVideo'),
		userLoggedHlpr = $('li.menu-kredit a').attr('title'),
		userLogged = (userLoggedHlpr && userLoggedHlpr.indexOf('B') > -1) ? 'logged' : 'anon',
		canStream = vData.userCanStream ? 'can' : 'cant',
		message = null;

	switch (location.hostname) {
		case 'www.ulozto.net':
		case 'www.zachowajto.pl':
		case 'ulozto.net':
		case 'zachowajto.pl':
			message = {
				'logged-cant':'<h4>Watch online &nbsp;<sup>BETA</sup></h4><ul><li>watch immediately & without waiting</li><li>streaming consumes credit</li><li>once charged, you can watch or download the video in 24 hours freely</li></ul><h5><a href="/kredit">I want to watch online</a></h5>',
				'logged-can':'<h4>Watch online &nbsp;<sup>BETA</sup></h4><ul><li>watch immediately & without waiting</li><li>price is the same as for download</li><li>once charged, you can watch or download the video in 24 hours freely</li></ul><h5><a href="/faq?videostreaming#videostreaming">More information</a></h5>',
				'anon-cant':'<h4>Watch online &nbsp;<sup>BETA</sup></h4><ul><li>for logged-in users only</li><li>streaming consumes credit</li><li>once charged, you can watch or download the video in 24 hours freely</li></ul><h5><a href="?do=web-login">I want to watch online</a></h5>'
			};
			break;
		default:
			message = {
				'logged-cant':'<h4>Sleduj online &nbsp;<sup>BETA</sup></h4><ul><li>sleduj video ihned a bez čekání</li><li>pro přehrávání je potřeba kredit</li><li>po odečtení kreditu sleduj či stahuj video po dalších 24h zdarma</li></ul><h5><a href="/kredit">Chci přehrávat online</a></h5>',
				'logged-can':'<h4>Sleduj online &nbsp;<sup>BETA</sup></h4><ul><li>sleduj video ihned a bez čekání</li><li>cena je stejná jako za stahování</li><li>po odečtení kreditu sleduj či stahuj video po dalších 24h zdarma</li></ul><h5><a href="/faq?videostreaming#videostreaming">Více informací</a></h5>',
				'anon-cant':'<h4>Sleduj online &nbsp;<sup>BETA</sup></h4><ul><li>pouze pro přihlášené uživatele</li><li>pro přehrávání je potřeba kredit</li><li>po odečtení kreditu sleduj či stahuj video po dalších 24h zdarma</li></ul><h5><a href="?do=web-login">Chci přehrávat online</a></h5>'
			};
			break;
	}

	if (!vData.isStreamable || vData.bitRate > 8000000 || vData.videoCodec != 'AVC' || 
		!myVid || !myVid.canPlayType || !myVid.canPlayType('video/mp4') || 
		!thumbHolder.length) {
		return; // skip player initialization, conditions are not met
	}

	// add video, info box and icon to the image thumbnails area
	thumbHolder.append('<div id="video-container"><video src="[[STREAMDATAURI]]" preload="none" controls style="visibility:hidden"></video></div><svg id="icoPlay" class="initer" width="150" height="150" viewBox="0 0 30 30"><circle cx="15" cy="15" r="14" stroke-width="0" fill="black" fill-opacity=".4"/><path d="M10,7 23,15 10,23z" stroke-linejoin="round" stroke-width="1.2" stroke="white" opacity=".66" fill="rgb(241,200,4)"/></svg><div class="streamPlayer">[[MESSAGE2SHOW]]</div>'.replace('[[STREAMDATAURI]]', vData.streamUri).replace('[[MESSAGE2SHOW]]', message[userLogged + "-" + canStream]));

	// prepare necessary elements and variables
	var vid = $('div#video-container video'),
		video = vid[0],
		hint = $('div.streamPlayer'),
		ico = $('svg#icoPlay'),
		state = 0;

	// video playback initialization
	hint.addClass('showBox');
	ico.css('display', 'block');

	if (!vData.userCanStream || !vData.streamUri) {
		return; // skip initialization in case of not having enough credit
	}

	// set several listeners
	video.addEventListener('playing', playing);
	video.addEventListener('pause', pausePlay);
	video.addEventListener('ended', pausePlay);
	//hint[0].addEventListener('click', checkPlay);
	ico[0].addEventListener('click', checkPlay);

	// method run when video playback is turned on
	function playing(evt) {
		state = 1;
		vid.css('visibility', 'visible');
		hint.removeClass('showBox');
		vid.css('pointer-events', 'auto');
		// send monitoring event to the GA
		dataLayer.push({'event': 'ga.event', 'eCategory': 'Videostreaming', 'eAction': 'Play', 'eLabel': undefined, 'eValue': undefined });
	}
	// method run when video is paused od ended
	function pausePlay(evt) {
		if (!video.seeking) {
			state = 0;
			hint.addClass('showBox');
		}
	}
	// method run used for custom video control elements
	function checkPlay(evt) {
		if (state) {
			vid[0].pause();
			state = 0;
		} else {
			vid[0].play();
            ico.attr('class', ''); // jQuery limitation for SVG
            vid.css('visibility', 'visible'); // stupid Chrome's autoplay blocker workaround
			vid.css('pointer-events', 'auto');
		}
	}
})();
</script>
